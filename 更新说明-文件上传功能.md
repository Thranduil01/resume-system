# 🎉 新功能：文件上传支持

## ✨ 更新内容

### 1. 双模式切换
- **📁 本地路径模式**：适合本地部署，直接输入文件夹路径
- **☁️ 文件上传模式**：适合云端部署，支持在线上传文件

### 2. 文件上传功能
- ✅ 支持批量上传（多个 PDF 文件）
- ✅ 拖拽上传（鼠标拖放文件到上传区域）
- ✅ 实时预览（显示已选择的文件列表）
- ✅ 单文件最大 50MB
- ✅ 自动清理临时文件

### 3. Railway 云端部署支持
- ✅ 优化了云端部署配置
- ✅ 自动端口配置
- ✅ 临时文件管理
- ✅ 完整的部署指南

---

## 📋 使用说明

### 本地使用（推荐个人用户）

1. **启动系统**
   ```bash
   # macOS
   双击 "启动系统.command"
   
   # Windows
   双击 "start.bat"
   ```

2. **选择模式**
   - 点击 **"📁 本地路径"** 按钮
   - 输入 PDF 文件夹路径
   - 点击 **"开始解析"**

3. **优势**
   - ⚡ 更快速（无需上传）
   - 🔒 更安全（文件不离开本地）
   - 💪 功能完整（支持 OCR）

---

### 云端使用（推荐团队协作）

1. **部署到 Railway**
   - 查看 `Railway部署指南.md`
   - 按步骤部署到云端
   - 获取访问 URL

2. **使用系统**
   - 访问部署的 URL
   - 点击 **"☁️ 文件上传"** 按钮
   - 拖拽或选择 PDF 文件
   - 点击 **"开始解析上传的文件"**

3. **优势**
   - 🌐 随时随地访问
   - 👥 团队共享使用
   - 📱 支持移动设备

---

## 🔄 界面改动

### 新增模式切换器
```
┌─────────────────────────────┐
│ [📁 本地路径] [☁️ 文件上传] │
└─────────────────────────────┘
```

### 文件上传界面
```
┌──────────────────────────────────┐
│          📄                       │
│   点击或拖拽上传 PDF 文件          │
│   支持批量上传，单个文件最大 50MB  │
└──────────────────────────────────┘

已选择 3 个文件
- 📄 resume1.pdf (2.5 MB)  [删除]
- 📄 resume2.pdf (3.1 MB)  [删除]
- 📄 resume3.pdf (1.8 MB)  [删除]

     [开始解析上传的文件]
```

---

## 🔧 技术改动

### 后端 (`app.py`)
```python
# 新增文件上传端点
@app.route('/api/upload', methods=['POST'])
def upload_files():
    """
    1. 接收上传的文件
    2. 保存到 uploads/ 临时文件夹
    3. 解析 PDF
    4. 存入数据库
    5. 自动删除临时文件
    """
    pass

# 新增文件处理通用函数
def process_pdf_files(pdf_files, use_ocr, grok_api_key):
    """统一的 PDF 处理逻辑，支持本地和上传两种模式"""
    pass
```

### 前端 (`index.html`)
```javascript
// 新增功能
- switchMode()        // 切换本地/上传模式
- handleFiles()       // 处理文件选择
- displayFileList()   // 显示文件列表
- removeFile()        // 移除单个文件
- uploadPDFs()        // 上传并解析
- 拖拽上传支持       // dragover, drop 事件
```

### 配置文件
```
新增:
├── Railway部署指南.md     ← 详细的 Railway 部署教程
├── README-Cloud.md        ← 云端部署说明
├── 更新说明-文件上传功能.md ← 本文件
└── uploads/               ← 临时上传文件夹（自动创建）

更新:
├── .gitignore             ← 忽略 uploads/ 和 *.pdf
├── app.py                 ← 新增上传端点
└── templates/index.html   ← 新增双模式界面
```

---

## ⚠️ 重要说明

### 云端部署的限制

#### ❌ 无法使用的功能
- **本地路径模式**：云服务器无法访问用户本地文件系统

#### ✅ 可以使用的功能
- **文件上传模式**：完全支持
- **数据存储**：数据库持久化
- **邮箱提取**：完整功能
- **Grok API**：完整支持

#### ⚠️ 部分支持的功能
- **OCR 识别**：
  - 不使用 Docker：不支持
  - 使用 Docker 部署：完整支持
  - 替代方案：使用 Grok API

---

## 📊 功能对比

| 功能 | 本地部署 | 云端部署 |
|------|---------|---------|
| **本地路径模式** | ✅ 支持 | ❌ 不支持 |
| **文件上传模式** | ✅ 支持 | ✅ 支持 |
| **OCR 识别** | ✅ 完整支持 | ⚠️ 需Docker |
| **Grok API** | ✅ 支持 | ✅ 支持 |
| **数据持久化** | ✅ 永久 | ✅ 永久 |
| **访问方式** | 本地 | 在线URL |
| **团队协作** | ❌ | ✅ |
| **成本** | 免费 | 免费额度 |

---

## 🎯 推荐使用场景

### 场景1：个人使用，文件在本地
**推荐方案**：本地部署 + 本地路径模式
```bash
# 1. 双击启动脚本
# 2. 选择 "📁 本地路径"
# 3. 输入文件夹路径
```

### 场景2：团队协作，需要在线访问
**推荐方案**：Railway 部署 + 文件上传模式
```bash
# 1. 部署到 Railway
# 2. 分享 URL 给团队
# 3. 团队成员上传文件使用
```

### 场景3：需要强大的识别能力
**推荐方案**：本地部署 + OCR + Grok API
```bash
# 1. 安装 Tesseract OCR
# 2. 配置 Grok API Key
# 3. 三级识别策略全开
```

### 场景4：移动办公，随时使用
**推荐方案**：Railway 部署 + Grok API
```bash
# 1. 部署到 Railway
# 2. 配置 Grok API（环境变量）
# 3. 手机/平板访问 URL
```

---

## 🚀 快速开始

### 本地测试文件上传
```bash
# 1. 启动系统
python3 app.py

# 2. 打开浏览器
http://localhost:5001

# 3. 切换到 "☁️ 文件上传" 模式
# 4. 上传测试文件
```

### 部署到 Railway
```bash
# 1. 初始化 Git
git init
git add .
git commit -m "Add upload feature"

# 2. 推送到 GitHub
git remote add origin https://github.com/YOUR_USERNAME/resume-system.git
git push -u origin main

# 3. 在 Railway 部署
# - 访问 https://railway.app
# - 选择 "Deploy from GitHub repo"
# - 选择你的仓库
```

详细步骤查看：`Railway部署指南.md`

---

## 🔍 文件处理流程

### 本地路径模式
```
用户输入路径 → 扫描文件夹 → 读取PDF → 解析 → 存储 → 完成
```

### 文件上传模式
```
用户选择文件 → 上传到服务器 → 保存临时文件 → 解析 → 存储 → 删除临时文件 → 完成
```

---

## 📝 更新日志

### v2.0.0 (2024-10-30)
- ✨ 新增文件上传功能
- ✨ 新增模式切换（本地/云端）
- ✨ 支持拖拽上传
- ✨ 优化云端部署支持
- 📝 新增 Railway 部署指南
- 🐛 修复临时文件清理问题
- 💄 优化上传界面样式

### v1.0.0 (之前版本)
- ✅ 基础 PDF 解析
- ✅ OCR 识别
- ✅ Grok API 支持
- ✅ 数据库存储
- ✅ 邮箱提取和导出

---

## 💡 常见问题

### Q: 为什么云端部署不能用本地路径？
**A**: 这是云服务的安全限制，服务器无法访问用户本地文件系统。必须通过文件上传方式。

### Q: 上传的文件会保存吗？
**A**: 不会。系统会在解析完成后自动删除临时文件，只保留提取的数据。

### Q: 可以同时上传多少个文件？
**A**: 理论上无限制，但受限于：
- 单文件大小：50MB
- 浏览器内存限制
- 服务器带宽和性能

### Q: 云端部署能用 OCR 吗？
**A**: 
- 标准部署：不支持（缺少系统依赖）
- Docker 部署：完整支持
- 推荐使用 Grok API 代替

### Q: 本地部署也能用文件上传吗？
**A**: 可以！两种模式都支持，可以自由切换。

---

## 🎉 总结

这次更新让系统**既能本地高效使用，又能云端灵活部署**，满足了不同场景的需求。

**选择建议**：
- 🏠 **个人用户**：本地部署，简单快速
- 👥 **团队协作**：Railway 部署，在线共享
- 🚀 **最佳实践**：本地开发测试，云端生产使用

**下一步**：
- 查看 `Railway部署指南.md` 开始部署
- 或直接双击启动脚本本地使用

---

**祝使用愉快！** 🎊

如有问题，请查看相关文档或反馈。

