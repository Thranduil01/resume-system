# 🌐 部署指南 - 让别人通过网址访问

## 📋 部署方案对比

| 方案 | 难度 | 费用 | 适用场景 | 访问范围 |
|------|------|------|----------|----------|
| **方案1：局域网部署** | ⭐ 简单 | 免费 | 公司/学校内部使用 | 同一WiFi |
| **方案2：内网穿透** | ⭐⭐ 中等 | 免费/付费 | 临时分享 | 全球 |
| **方案3：云服务器** | ⭐⭐⭐ 较难 | 付费 | 长期稳定使用 | 全球 |
| **方案4：云平台** | ⭐⭐ 中等 | 免费/付费 | 快速部署 | 全球 |

---

## 🏠 方案1：局域网部署（最简单）

### 适用场景
- 同一个办公室/宿舍的人使用
- 临时使用，不需要长期运行

### 步骤

#### 1. 获取你的局域网IP

**macOS/Linux**:
```bash
ifconfig | grep "inet " | grep -v 127.0.0.1
```

**Windows**:
```cmd
ipconfig
```

找到类似 `192.168.x.x` 的IP地址

#### 2. 修改 app.py，允许外部访问

打开 `app.py`，找到最后一行：
```python
app.run(host='0.0.0.0', port=5001, debug=True)
```

确保 `host='0.0.0.0'`（已经是这样了）

#### 3. 启动服务器
```bash
python3 app.py
```

#### 4. 分享访问地址

告诉别人访问：
```
http://你的IP地址:5001
```

例如：`http://192.168.1.100:5001`

### ⚠️ 注意事项
- 只有连接同一个WiFi的人能访问
- 你的电脑必须一直开着
- 关闭电脑或断网就无法访问

---

## 🌍 方案2：内网穿透（推荐临时使用）

### 适用场景
- 需要让外网的人访问
- 不想购买服务器
- 临时演示或测试

### 推荐工具

#### 选项A：ngrok（国际，稳定）

**1. 安装 ngrok**
```bash
# macOS
brew install ngrok

# 或下载：https://ngrok.com/download
```

**2. 注册账号**
- 访问 https://ngrok.com/
- 免费注册获取 authtoken

**3. 配置 authtoken**
```bash
ngrok config add-authtoken YOUR_TOKEN
```

**4. 启动应用**
```bash
# 终端1：启动Flask
python3 app.py

# 终端2：启动ngrok
ngrok http 5001
```

**5. 获取公网地址**

ngrok会显示：
```
Forwarding    https://xxxx-xx-xx-xx-xx.ngrok-free.app -> http://localhost:5001
```

把这个网址分享给别人即可！

#### 选项B：cpolar（国内，速度快）

**1. 安装 cpolar**
```bash
# 访问 https://www.cpolar.com/
# 下载并安装
```

**2. 启动隧道**
```bash
cpolar http 5001
```

**3. 获取公网地址**
复制显示的公网URL分享

### ⚠️ 注意事项
- 免费版有流量限制
- URL会定期变化（付费版可固定）
- 你的电脑必须开着
- 网络不稳定会断线

---

## ☁️ 方案3：云服务器部署（推荐长期使用）

### 适用场景
- 需要7x24小时运行
- 多人长期使用
- 数据需要保存

### 推荐服务商

| 服务商 | 价格 | 配置 | 特点 |
|--------|------|------|------|
| **阿里云** | ¥99/年 | 1核2G | 学生优惠 |
| **腾讯云** | ¥88/年 | 1核2G | 新用户优惠 |
| **AWS** | $0-10/月 | 1核1G | 免费1年 |
| **DigitalOcean** | $6/月 | 1核1G | 国际稳定 |

### 部署步骤（以阿里云为例）

#### 1. 购买云服务器
- 选择 Ubuntu 20.04 LTS 系统
- 1核2G内存足够
- 记住服务器IP和密码

#### 2. 连接服务器
```bash
ssh root@你的服务器IP
```

#### 3. 安装环境
```bash
# 更新系统
apt update && apt upgrade -y

# 安装Python3
apt install python3 python3-pip -y

# 安装Tesseract OCR（可选）
apt install tesseract-ocr tesseract-ocr-chi-sim -y

# 安装Poppler（可选）
apt install poppler-utils -y
```

#### 4. 上传代码

**方法1：使用 scp**
```bash
# 在你的电脑上运行
cd "/Users/zhanghan5/Downloads/6. coding/1030 intern_email_address"
scp -r . root@服务器IP:/root/resume_system/
```

**方法2：使用 Git**
```bash
# 在服务器上
cd /root
git clone 你的代码仓库地址
```

#### 5. 安装依赖
```bash
cd /root/resume_system
pip3 install -r requirements-minimal.txt
# 如果需要OCR
pip3 install -r requirements-ocr.txt
```

#### 6. 配置防火墙
```bash
# 开放5001端口
ufw allow 5001
ufw enable
```

#### 7. 使用生产级服务器

**安装 gunicorn**
```bash
pip3 install gunicorn
```

**创建启动脚本** `start.sh`:
```bash
#!/bin/bash
gunicorn -w 4 -b 0.0.0.0:5001 app:app
```

**后台运行**
```bash
chmod +x start.sh
nohup ./start.sh > server.log 2>&1 &
```

#### 8. 配置开机自启（可选）

创建 systemd 服务文件：
```bash
nano /etc/systemd/system/resume-system.service
```

内容：
```ini
[Unit]
Description=Resume Extraction System
After=network.target

[Service]
User=root
WorkingDirectory=/root/resume_system
ExecStart=/usr/bin/python3 app.py
Restart=always

[Install]
WantedBy=multi-user.target
```

启用服务：
```bash
systemctl enable resume-system
systemctl start resume-system
```

#### 9. 配置域名（可选）

如果有域名：
- 在域名DNS设置中添加A记录，指向服务器IP
- 访问 `http://你的域名.com:5001`

#### 10. 配置 Nginx 反向代理（推荐）

**安装 Nginx**
```bash
apt install nginx -y
```

**配置文件** `/etc/nginx/sites-available/resume`:
```nginx
server {
    listen 80;
    server_name 你的域名.com;

    location / {
        proxy_pass http://127.0.0.1:5001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

**启用配置**
```bash
ln -s /etc/nginx/sites-available/resume /etc/nginx/sites-enabled/
nginx -t
systemctl reload nginx
```

现在可以通过 `http://你的域名.com` 访问（不需要端口号）

#### 11. 配置 HTTPS（推荐）

**使用 Let's Encrypt 免费证书**
```bash
apt install certbot python3-certbot-nginx -y
certbot --nginx -d 你的域名.com
```

自动续期：
```bash
certbot renew --dry-run
```

现在可以通过 `https://你的域名.com` 安全访问

---

## 🚀 方案4：云平台部署（最快速）

### 选项A：Railway（推荐）

**特点**：
- 免费额度：$5/月
- 支持自动部署
- 简单易用

**步骤**：

1. **准备 requirements.txt**（已有）

2. **创建 Procfile**
```bash
echo "web: gunicorn app:app" > Procfile
```

3. **修改端口配置**

在 `app.py` 最后修改为：
```python
import os
port = int(os.environ.get('PORT', 5001))
app.run(host='0.0.0.0', port=port)
```

4. **推送到 GitHub**
```bash
git init
git add .
git commit -m "Initial commit"
git remote add origin 你的仓库地址
git push -u origin main
```

5. **部署到 Railway**
- 访问 https://railway.app/
- 注册登录
- New Project → Deploy from GitHub
- 选择你的仓库
- 等待自动部署

6. **获取访问地址**
- Settings → Generate Domain
- 复制生成的URL分享

### 选项B：Render（免费）

**特点**：
- 完全免费
- 自动HTTPS
- 简单配置

**步骤类似 Railway**

### 选项C：Heroku

**特点**：
- 老牌云平台
- 文档丰富
- 免费额度有限

---

## 🔒 安全建议

### 1. 添加身份验证

**简单方案：HTTP Basic Auth**

安装：
```bash
pip3 install Flask-HTTPAuth
```

在 `app.py` 添加：
```python
from flask_httpauth import HTTPBasicAuth
auth = HTTPBasicAuth()

users = {
    "admin": "your_password"
}

@auth.verify_password
def verify_password(username, password):
    if username in users and users[username] == password:
        return username

# 在路由添加 @auth.login_required
@app.route('/')
@auth.login_required
def index():
    return render_template('index.html')
```

### 2. 限制访问IP（可选）

在 `app.py` 添加：
```python
from flask import request, abort

ALLOWED_IPS = ['192.168.1.100', '10.0.0.50']

@app.before_request
def limit_remote_addr():
    if request.remote_addr not in ALLOWED_IPS:
        abort(403)
```

### 3. 设置文件上传限制

在 `app.py` 添加：
```python
app.config['MAX_CONTENT_LENGTH'] = 100 * 1024 * 1024  # 100MB
```

---

## 📊 方案推荐

### 如果是临时使用（几天）
→ **内网穿透（ngrok/cpolar）** ⭐⭐⭐⭐⭐
- 免费
- 立即可用
- 无需配置

### 如果是公司内部使用
→ **局域网部署** ⭐⭐⭐⭐⭐
- 完全免费
- 速度快
- 安全

### 如果需要长期稳定使用
→ **云服务器 + Nginx + HTTPS** ⭐⭐⭐⭐⭐
- 专业
- 稳定
- 可控

### 如果想快速上线
→ **Railway/Render** ⭐⭐⭐⭐
- 免费
- 自动部署
- 简单

---

## 🛠 部署检查清单

部署前确认：

- [ ] 数据库文件 `resumes.db` 在 `.gitignore` 中（防止覆盖）
- [ ] 环境变量正确配置
- [ ] 端口开放（如5001）
- [ ] 防火墙规则配置
- [ ] OCR环境安装（如需要）
- [ ] 测试所有功能正常
- [ ] 备份重要数据
- [ ] 设置监控和日志
- [ ] 配置自动重启
- [ ] 添加访问控制（如需要）

---

## 📞 需要帮助？

选择你想用的方案，我可以给你更详细的步骤！

**推荐顺序**：
1. 先用内网穿透测试（立即可用）
2. 确认需求后再考虑云服务器（长期稳定）

